{% extends "base.html" %}

{% block title %}Sales Tax Calculator - Cheers Liquor Mart{% endblock %}

{% block header_title %}Sales Tax Calculator{% endblock %}

{% block additional_style %}
<style>
    .form-container {
        padding: 1.5rem;
    }
    .results-section {
        padding: 1.5rem;
        border-top: 1px solid #dee2e6;
    }
    .section-header {
        background-color: #f2f2f2;
        padding: 0.5rem 1rem;
        margin-bottom: 1rem;
        border-radius: 5px;
    }
    .back-button {
        margin-bottom: 1rem;
    }
    .jurisdiction-row {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: 1px solid #e9e9e9;
    }
    .add-row-button {
        margin-top: 1rem;
        margin-bottom: 1.5rem;
    }
    .delete-row-btn {
        margin-top: 1.75rem;
    }
    .table-container {
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
    }
    table.results-table {
        width: 100%;
        font-size: 0.9rem;
    }
    table.results-table th {
        position: sticky;
        top: 0;
        background-color: rgba(209, 0, 0, 0.1);
        color: var(--cheers-secondary);
        z-index: 1;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="section-header">
        <h4 class="mb-0">Enter Tax Collection Data</h4>
    </div>
    <form id="salesTaxForm">
        <div class="mb-3">
            <p class="text-muted">Enter the tax amounts collected by jurisdiction from your POS system. The calculator will determine sales amounts and tax distributions.</p>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-primary">
                    <tr>
                        <th>Jurisdiction Code</th>
                        <th>City Name</th>
                        <th>Standard Tax Collected ($)</th>
                        <th>Cigarette Tax Collected ($)</th>
                        <th>Soda Tax Collected ($)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>040017</td>
                        <td>COLORADO SPRINGS</td>
                        <td><input type="number" class="form-control" id="standardTax_040017" name="standardTax_040017" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040017" name="cigaretteTax_040017" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040017" name="sodaTax_040017" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040031</td>
                        <td>FOUNTAIN</td>
                        <td><input type="number" class="form-control" id="standardTax_040031" name="standardTax_040031" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040031" name="cigaretteTax_040031" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040031" name="sodaTax_040031" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040052</td>
                        <td>MANITOU SPRINGS</td>
                        <td><input type="number" class="form-control" id="standardTax_040052" name="standardTax_040052" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040052" name="cigaretteTax_040052" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040052" name="sodaTax_040052" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040059</td>
                        <td>PALMER LAKE</td>
                        <td><input type="number" class="form-control" id="standardTax_040059" name="standardTax_040059" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040059" name="cigaretteTax_040059" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040059" name="sodaTax_040059" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040097</td>
                        <td>WOODLAND PARK</td>
                        <td><input type="number" class="form-control" id="standardTax_040097" name="standardTax_040097" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040097" name="cigaretteTax_040097" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040097" name="sodaTax_040097" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040057</td>
                        <td>MONUMENT</td>
                        <td><input type="number" class="form-control" id="standardTax_040057" name="standardTax_040057" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040057" name="cigaretteTax_040057" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040057" name="sodaTax_040057" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040206</td>
                        <td>FALCON</td>
                        <td><input type="number" class="form-control" id="standardTax_040206_falcon" name="standardTax_040206_falcon" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040206_falcon" name="cigaretteTax_040206_falcon" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040206_falcon" name="sodaTax_040206_falcon" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040206</td>
                        <td>SECURITY/WIDEFIELD</td>
                        <td><input type="number" class="form-control" id="standardTax_040206_sw" name="standardTax_040206_sw" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040206_sw" name="cigaretteTax_040206_sw" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040206_sw" name="sodaTax_040206_sw" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040206</td>
                        <td>CHIPITA PARK</td>
                        <td><input type="number" class="form-control" id="standardTax_040206_cp" name="standardTax_040206_cp" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040206_cp" name="cigaretteTax_040206_cp" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040206_cp" name="sodaTax_040206_cp" step="0.01" min="0" value="0"></td>
                    </tr>
                    <tr>
                        <td>040206</td>
                        <td>PEYTON</td>
                        <td><input type="number" class="form-control" id="standardTax_040206_peyton" name="standardTax_040206_peyton" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="cigaretteTax_040206_peyton" name="cigaretteTax_040206_peyton" step="0.01" min="0" value="0"></td>
                        <td><input type="number" class="form-control" id="sodaTax_040206_peyton" name="sodaTax_040206_peyton" step="0.01" min="0" value="0"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
            <button type="button" id="loadSampleBtn" class="btn btn-outline-info">Load Sample Data</button>
            <button type="submit" class="btn btn-primary">Calculate Taxes</button>
            <button type="button" id="generateReport" class="btn btn-success" disabled>Generate Excel Report</button>
        </div>
    </form>
</div>

<!-- Hide the old jurisdictionRows div -->
<div id="jurisdictionRows" style="display: none;">
    <!-- Old content kept for JavaScript compatibility but hidden -->
    <div class="jurisdiction-row" data-row="0">
        <!-- Original form structure kept but hidden -->
    </div>
</div>

<!-- Hide the add row button -->
<div class="d-grid gap-2" style="display: none;">
    <button type="button" class="btn btn-outline-primary add-row-button" onclick="addJurisdictionRow()">
        <i class="bi bi-plus-circle"></i> Add Another Jurisdiction
    </button>
</div>

<!-- Results Section (initially hidden) -->
<div class="results-section" id="resultsSection" style="display: none;">
    <div class="section-header">
        <h4 class="mb-0">Calculation Results</h4>
    </div>

    <ul class="nav nav-tabs" id="resultTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="sales-tab" data-bs-toggle="tab" data-bs-target="#sales" type="button" role="tab" aria-controls="sales" aria-selected="true">Sales Summary</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tax-tab" data-bs-toggle="tab" data-bs-target="#tax" type="button" role="tab" aria-controls="tax" aria-selected="false">Tax Distributions</button>
        </li>
    </ul>

    <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="sales" role="tabpanel" aria-labelledby="sales-tab">
            <div class="table-container">
                <table class="table table-striped table-bordered results-table">
                    <thead>
                        <tr>
                            <th>Jurisdiction</th>
                            <th>City Name</th>
                            <th>Tax Collected</th>
                            <th>Standard Sales</th>
                            <th>Cigarette Sales</th>
                            <th>Soda Sales</th>
                            <th>Total Sales</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <!-- Sales results will be displayed here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="tax" role="tabpanel" aria-labelledby="tax-tab">
            <div class="table-container">
                <table class="table table-striped table-bordered results-table">
                    <thead>
                        <tr>
                            <th>Jurisdiction</th>
                            <th>City Name</th>
                            <th>County Tax</th>
                            <th>City Tax</th>
                            <th>RTA Tax</th>
                            <th>State Tax</th>
                            <th>State Service Fee</th>
                            <th>City Service Fee</th>
                            <th>Net Tax</th>
                        </tr>
                    </thead>
                    <tbody id="taxTableBody">
                        <!-- Tax distribution results will be displayed here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let rowCount = 1; // Keep this for compatibility

    // Add load sample data function
    function loadSampleData() {
        // Clear existing values
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.value = "0";
        });

        // Set values from the receipt image
        // Colorado Springs (SALES TAX - standard)
        document.getElementById('standardTax_040017').value = "57374.49";

        // Colorado Springs (CIG tax)
        document.getElementById('cigaretteTax_040017').value = "346.58";

        // Colorado Springs (SODA tax)
        document.getElementById('sodaTax_040017').value = "125.90";

        // Palmer Lake
        document.getElementById('standardTax_040059').value = "36.22";

        // Falcon
        document.getElementById('standardTax_040206_falcon').value = "0.78";

        // Manitou Springs
        document.getElementById('standardTax_040052').value = "156.73";
        document.getElementById('sodaTax_040052').value = "1.07";

        // Chipita Park
        document.getElementById('standardTax_040206_cp').value = "26.66";

        // Woodland Park
        document.getElementById('standardTax_040097').value = "6.20";

        // Fountain
        document.getElementById('standardTax_040031').value = "142.16";

        // Monument
        document.getElementById('standardTax_040057').value = "36.14";

        // Security/Widefield
        document.getElementById('standardTax_040206_sw').value = "8.54";

        // Peyton
        document.getElementById('standardTax_040206_peyton').value = "32.00";
    }

    function addJurisdictionRow() {
        // Function kept for compatibility but no longer used
    }

    function deleteJurisdictionRow(rowIndex) {
        // Function kept for compatibility but no longer used
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Add event listener for the load sample button
        document.getElementById('loadSampleBtn').addEventListener('click', loadSampleData);

        const salesTaxForm = document.getElementById('salesTaxForm');
        const resultsSection = document.getElementById('resultsSection');
        const generateReportBtn = document.getElementById('generateReport');
        let lastCalculationData = null;

        salesTaxForm.addEventListener('submit', function(e) {
            e.preventDefault();
            calculateTaxes();
        });

        generateReportBtn.addEventListener('click', function() {
            generateExcelReport();
        });

        function calculateTaxes() {
            // Collect tax data from the table
            const taxData = [];

            // Colorado Springs
            if (parseFloat(document.getElementById('standardTax_040017').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040017').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040017').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040017',
                    city_name: 'COLORADO SPRINGS',
                    standard_tax: document.getElementById('standardTax_040017').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040017').value || '0',
                    soda_tax: document.getElementById('sodaTax_040017').value || '0'
                });
            }

            // Fountain
            if (parseFloat(document.getElementById('standardTax_040031').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040031').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040031').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040031',
                    city_name: 'FOUNTAIN',
                    standard_tax: document.getElementById('standardTax_040031').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040031').value || '0',
                    soda_tax: document.getElementById('sodaTax_040031').value || '0'
                });
            }

            // Manitou Springs
            if (parseFloat(document.getElementById('standardTax_040052').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040052').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040052').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040052',
                    city_name: 'MANITOU SPRINGS',
                    standard_tax: document.getElementById('standardTax_040052').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040052').value || '0',
                    soda_tax: document.getElementById('sodaTax_040052').value || '0'
                });
            }

            // Palmer Lake
            if (parseFloat(document.getElementById('standardTax_040059').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040059').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040059').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040059',
                    city_name: 'PALMER LAKE',
                    standard_tax: document.getElementById('standardTax_040059').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040059').value || '0',
                    soda_tax: document.getElementById('sodaTax_040059').value || '0'
                });
            }

            // Woodland Park
            if (parseFloat(document.getElementById('standardTax_040097').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040097').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040097').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040097',
                    city_name: 'WOODLAND PARK',
                    standard_tax: document.getElementById('standardTax_040097').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040097').value || '0',
                    soda_tax: document.getElementById('sodaTax_040097').value || '0'
                });
            }

            // Monument
            if (parseFloat(document.getElementById('standardTax_040057').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040057').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040057').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040057',
                    city_name: 'MONUMENT',
                    standard_tax: document.getElementById('standardTax_040057').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040057').value || '0',
                    soda_tax: document.getElementById('sodaTax_040057').value || '0'
                });
            }

            // Falcon (Unincorporated)
            if (parseFloat(document.getElementById('standardTax_040206_falcon').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040206_falcon').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040206_falcon').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040206',
                    city_name: 'FALCON',
                    standard_tax: document.getElementById('standardTax_040206_falcon').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040206_falcon').value || '0',
                    soda_tax: document.getElementById('sodaTax_040206_falcon').value || '0'
                });
            }

            // Security/Widefield (Unincorporated)
            if (parseFloat(document.getElementById('standardTax_040206_sw').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040206_sw').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040206_sw').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040206',
                    city_name: 'SECURITY/WIDEFIELD',
                    standard_tax: document.getElementById('standardTax_040206_sw').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040206_sw').value || '0',
                    soda_tax: document.getElementById('sodaTax_040206_sw').value || '0'
                });
            }

            // Chipita Park (Unincorporated)
            if (parseFloat(document.getElementById('standardTax_040206_cp').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040206_cp').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040206_cp').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040206',
                    city_name: 'CHIPITA PARK',
                    standard_tax: document.getElementById('standardTax_040206_cp').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040206_cp').value || '0',
                    soda_tax: document.getElementById('sodaTax_040206_cp').value || '0'
                });
            }

            // Peyton (Unincorporated)
            if (parseFloat(document.getElementById('standardTax_040206_peyton').value) > 0 ||
                parseFloat(document.getElementById('cigaretteTax_040206_peyton').value) > 0 ||
                parseFloat(document.getElementById('sodaTax_040206_peyton').value) > 0) {
                taxData.push({
                    jurisdiction_code: '040206',
                    city_name: 'PEYTON',
                    standard_tax: document.getElementById('standardTax_040206_peyton').value,
                    cigarette_tax: document.getElementById('cigaretteTax_040206_peyton').value || '0',
                    soda_tax: document.getElementById('sodaTax_040206_peyton').value || '0'
                });
            }

            // Save for report generation
            lastCalculationData = taxData;

            // Only proceed if we have data
            if (taxData.length === 0) {
                alert('Please enter tax amounts for at least one jurisdiction.');
                return;
            }

            // Send to API
            fetch('/api/calculate-sales-tax', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({tax_data: taxData})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayResults(data.results);
                    generateReportBtn.disabled = false;
                    resultsSection.style.display = 'block';
                } else {
                    alert('Error calculating taxes: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while calculating taxes: ' + error);
            });
        }

        function displayResults(results) {
            // Get results data
            const salesData = results.sales_calculations;
            const taxData = results.tax_calculations;

            // Populate sales table
            const salesTableBody = document.getElementById('salesTableBody');
            salesTableBody.innerHTML = '';

            salesData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.jurisdiction_code}</td>
                    <td>${item.city_name}</td>
                    <td>$${formatNumber(item.total_tax_collected)}</td>
                    <td>$${formatNumber(item.standard_sales)}</td>
                    <td>$${formatNumber(item.cigarette_sales)}</td>
                    <td>$${formatNumber(item.soda_sales)}</td>
                    <td>$${formatNumber(item.total_sales)}</td>
                `;
                salesTableBody.appendChild(row);
            });

            // Add total row
            const totalTaxCollected = salesData.reduce((sum, item) => sum + item.total_tax_collected, 0);
            const totalStandardSales = salesData.reduce((sum, item) => sum + item.standard_sales, 0);
            const totalCigaretteSales = salesData.reduce((sum, item) => sum + item.cigarette_sales, 0);
            const totalSodaSales = salesData.reduce((sum, item) => sum + item.soda_sales, 0);
            const totalSales = salesData.reduce((sum, item) => sum + item.total_sales, 0);

            const totalSalesRow = document.createElement('tr');
            totalSalesRow.className = 'table-primary';
            totalSalesRow.innerHTML = `
                <td colspan="2"><strong>TOTAL</strong></td>
                <td><strong>$${formatNumber(totalTaxCollected)}</strong></td>
                <td><strong>$${formatNumber(totalStandardSales)}</strong></td>
                <td><strong>$${formatNumber(totalCigaretteSales)}</strong></td>
                <td><strong>$${formatNumber(totalSodaSales)}</strong></td>
                <td><strong>$${formatNumber(totalSales)}</strong></td>
            `;
            salesTableBody.appendChild(totalSalesRow);

            // Populate tax table
            const taxTableBody = document.getElementById('taxTableBody');
            taxTableBody.innerHTML = '';

            taxData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.jurisdiction_code}</td>
                    <td>${item.city_name}</td>
                    <td>$${formatNumber(item.county_tax)}</td>
                    <td>$${formatNumber(item.city_tax)}</td>
                    <td>$${formatNumber(item.rta_tax)}</td>
                    <td>$${formatNumber(item.state_tax)}</td>
                    <td>$${formatNumber(item.state_service_fee)}</td>
                    <td>$${formatNumber(item.city_service_fee)}</td>
                    <td>$${formatNumber(item.net_tax)}</td>
                `;
                taxTableBody.appendChild(row);
            });

            // Add total row
            const totalCountyTax = taxData.reduce((sum, item) => sum + item.county_tax, 0);
            const totalCityTax = taxData.reduce((sum, item) => sum + item.city_tax, 0);
            const totalRtaTax = taxData.reduce((sum, item) => sum + item.rta_tax, 0);
            const totalStateTax = taxData.reduce((sum, item) => sum + item.state_tax, 0);
            const totalStateServiceFee = taxData.reduce((sum, item) => sum + item.state_service_fee, 0);
            const totalCityServiceFee = taxData.reduce((sum, item) => sum + item.city_service_fee, 0);
            const totalNetTax = taxData.reduce((sum, item) => sum + item.net_tax, 0);

            const totalTaxRow = document.createElement('tr');
            totalTaxRow.className = 'table-primary';
            totalTaxRow.innerHTML = `
                <td colspan="2"><strong>TOTAL</strong></td>
                <td><strong>$${formatNumber(totalCountyTax)}</strong></td>
                <td><strong>$${formatNumber(totalCityTax)}</strong></td>
                <td><strong>$${formatNumber(totalRtaTax)}</strong></td>
                <td><strong>$${formatNumber(totalStateTax)}</strong></td>
                <td><strong>$${formatNumber(totalStateServiceFee)}</strong></td>
                <td><strong>$${formatNumber(totalCityServiceFee)}</strong></td>
                <td><strong>$${formatNumber(totalNetTax)}</strong></td>
            `;
            taxTableBody.appendChild(totalTaxRow);
        }

        function generateExcelReport() {
            if (!lastCalculationData || lastCalculationData.length === 0) {
                alert('No tax data to generate report. Please calculate taxes first.');
                return;
            }

            fetch('/api/generate-sales-tax-report', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({tax_data: lastCalculationData})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = data.download_url;
                } else {
                    alert('Error generating report: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while generating the report: ' + error);
            });
        }

        // Helper function to format numbers with commas and 2 decimal places
        function formatNumber(number) {
            return number.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    });
</script>
{% endblock %}
